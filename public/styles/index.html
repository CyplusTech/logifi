<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
  /* ===== Modal Overlay ===== */
.lodge-modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.75);
  display: none;  /* toggled with JS */
  justify-content: center;
  align-items: center;
  z-index: 2000;
  padding: 1rem;
  animation: fadeIn 0.3s ease-in-out;
}

/* ===== Modal Container ===== */
.lodge-modal-container {
  max-width: 900px;
  width: 100%;
  border-radius: 12px;
  background: #fff;
  position: relative;
  max-height: 95vh;          /* ‚úÖ never taller than viewport */
  display: flex;
  flex-direction: column;
  overflow: hidden;          /* header fixed, body scrolls */
}

/* ===== Close Button ===== */
.lodge-close-btn {
  position: absolute;
  top: 14px;
  right: 20px;
  font-size: 26px;
  font-weight: bold;
  color: #333;
  cursor: pointer;
  z-index: 5;
}

/* ===== Modal Content (scrollable area) ===== */
.lodge-modal-content {
  display: flex;
  flex-wrap: wrap;
  gap: 1.5rem;
  padding: 1.5rem;
  overflow-y: auto;         /* ‚úÖ scroll if content is long */
}

/* ===== Media Section ===== */
.lodge-img-gallery {
  display: flex;
  flex-direction: column;
  align-items: center;
  flex: 1 1 300px;
  width: 100%;
}

/* Main Image/Video */
.lodge-main-img,
.lodge-main-video {
  width: 100%;
  height: 100%;
  max-height: 320px;        /* ‚úÖ control media height */
  object-fit: contain;      /* ‚úÖ prevent stretching */
  border-radius: 8px;
  margin-bottom: 1rem;
  background: #000;         /* in case video has transparent area */
}

/* Thumbnails */
.lodge-thumbnails {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 10px;
}

.lodge-thumb {
  width: 70px;
  height: 70px;
  object-fit: cover;
  border: 2px solid #ddd;
  border-radius: 6px;
  cursor: pointer;
  transition: border 0.3s;
}

.lodge-thumb:hover {
  border-color: #007bff;
}

/* ===== Details Section ===== */
.lodge-details-section {
  flex: 1 1 300px;
  width: 100%;
  overflow: hidden;
}

.lodge-title {
  font-size: 1.5rem;
  margin-bottom: 0.5rem;
}

.lodge-location,
.lodge-price {
  font-weight: 500;
  margin: 0.5rem 0;
  color: #444;
}

/* Status styles */
.model-lodge-status {
  font-size: 0.95rem;
  font-weight: 500;
  margin: 0.25rem 0 0.75rem;
}

.status-available {
  background: #16a34a;
  color: #fff;
  padding: 4px 10px;
  border-radius: 999px;
  font-size: 0.85rem;
  font-weight: bold;
}

.status-unavailable {
  background: #92400e;
  color: #fff;
  padding: 4px 10px;
  border-radius: 999px;
  font-size: 0.85rem;
  font-weight: bold;
}

/* ===== Responsive Breakpoints ===== */

/* Tablets */
@media (max-width: 1024px) {
  .lodge-modal-container {
    max-width: 700px;
  }
  .lodge-main-img,
  .lodge-main-video {
    max-height: 250px;
  }
  .lodge-thumb {
    width: 60px;
    height: 60px;
  }
  .lodge-title {
    font-size: 1.3rem;
  }
}

/* Mobile */
@media (max-width: 768px) {
  .lodge-modal-content {
    flex-direction: column;
    gap: 1rem;
  }
  .lodge-main-img,
  .lodge-main-video {
    max-height: 220px;    /* shrink media */
  }
  .lodge-thumbnails {
    gap: 8px;
  }
}

/* Small Phones */
@media (max-width: 395px) {
  .lodge-modal-container {
    max-width: 95%;
    max-height: 95vh;
  }
  .lodge-main-img,
  .lodge-main-video {
    max-height: 160px;
  }
  .lodge-thumb {
    width: 40px;
    height: 40px;
  }
  .lodge-title {
    font-size: 1.1rem;
  }
}

    </style>
</head>
<body>
    <!-- Lodge View Modal from home page -->
<% if (selectedLodge) { %>
<div id="selected-lodgeModal" class="lodge-modal-overlay" style="display:flex; border: 1px solid red;">
  <div class="lodge-modal-container" style=" border: 1px solid red;">
    <span class="lodge-close-btn" onclick="closeLodgeModal()">&times;</span>

    <div class="lodge-modal-content">


      <div class="lodge-img-gallery">
  
<!-- Main Preview -->
<% if (selectedLodge.media && selectedLodge.media.length > 0) { %>
  <% if (selectedLodge.media[0].type === "video") { %>
    <video id="mainLodgeVideo-<%= selectedLodge._id %>" 
           class="lodge-main-video" 
           controls 
           onclick="openLightbox('<%= selectedLodge._id %>', 0)">
      <source src="<%= selectedLodge.media[0].url %>" type="video/mp4">
      Your browser does not support the video tag.
    </video>
  <% } else { %>
    <img id="mainLodgeImg-<%= selectedLodge._id %>" 
         src="<%= selectedLodge.media[0].url || selectedLodge.media[0].src || selectedLodge.media[0].path %>" 
         alt="Lodge Preview" 
         class="lodge-main-img" 
         onclick="openLightbox('<%= selectedLodge._id %>', 0)"/>
  <% } %>
<% } else { %>
  <img id="mainLodgeImg-<%= selectedLodge._id %>" 
       src="/images/about_image.webp" 
       alt="Fallback Preview" 
       class="lodge-main-img"/>
<% } %>


<!-- Thumbnails -->
<div class="lodge-thumbnails">
  <% if (selectedLodge.media && selectedLodge.media.length > 0) { %>
    <% selectedLodge.media.forEach(function(m, i){ %>
      <% if (m.type === "video") { %>
        <video class="lodge-thumb" 
               data-index="<%= i %>" 
               onclick="updateHomeImg('<%= selectedLodge._id %>', this)">
          <source src="<%= m.url %>" type="video/mp4">
        </video>
      <% } else { %>
        <img src="<%= m.url || m.src || m.path %>" 
             alt="Thumb" 
             class="lodge-thumb" 
             data-index="<%= i %>" 
             onclick="updateHomeImg('<%= selectedLodge._id %>', this)">
      <% } %>
    <% }) %>
  <% } %>
</div>


      </div>


      <div class="lodge-details-section">
      <div class="plx-agent-box">
        <span class="plx-agent-name"><%= selectedLodge.agent?.email%></span>

            <% if (selectedLodge.agent && selectedLodge.agent.kycCompleted) { %>
            <span class="shield-verified" title="Verified agent">
            <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
            <path fill="#0b8a55" d="M12 1 3 4v6c0 5 3.7 9.7 9 11 5.3-1.3 9-6 9-11V4l-9-3z"/>
            <path fill="#fff" d="M10 13.5l-1.6-1.6 1-1 1.6 1.6L15.6 8l1 1-6.6 4.5z"/>
            </svg>
      </span>
      <% } %>
      </div>
        <h2 id="selectedModalTitle"><%= selectedLodge.title %></h2>
        <div class="location" id="selectedModalLocation">
          <i class="fas fa-map-marker-alt"></i> <%= selectedLodge.location %>
        </div>
          <p class="lodge-price">
           üí∞ ‚Ç¶<span id="selectedModalPrice"> <%= Number(selectedLodge.price).toLocaleString() %></span> | 
            <span id="selectedModalRoomType"><%= selectedLodge.roomType || selectedLodge.type %></span>
          </p>

          <!-- ‚úÖ Status -->
          <p class="model-lodge-status">
            <span class="<%= selectedLodge.status === 'available' ? 'status-available' : 'status-unavailable' %>">
              <%= selectedLodge.status === 'available' ? 'Available' : 'Rented' %>
            </span>
          </p>
          
          <p id="selectedModalDescription"><%= selectedLodge.description || selectedLodge.desc %></p>

        <div class="warning-box">
          <strong>‚ö†Ô∏è Important:</strong> Don‚Äôt pay until you‚Äôve seen the place and met your roommate. Stay safe!
        </div>
      
             <!-- <div class="lodge-review-summary">
              <div class="avg-rating-stars">‚òÖ‚òÖ‚òÖ‚òÖ<span style="color: #ccc;">‚òÖ</span></div>
              <div class="total-review-count">(12 reviews)</div>
            </div> -->

         <div class="lodge-review-summary">
            <div class="avg-rating-stars">
              <% for(let i = 1; i <= 5; i++) { %>
                <span style="color: <%= i <= selectedLodge.avgRating ? '#FFD700' : '#ccc' %>">‚òÖ</span>
              <% } %>
            </div>
            <div class="total-review-count">(<%= selectedLodge.reviewCount %> reviews)</div>
          </div>

            <button onclick="openReviewModal('<%= selectedLodge.postedBy %>')" class="btn-write-review">Write a Review</button>

            <button class="contact-whatsapp-btn" 
            onclick="trackClick('contact_via_whatsapp', '<%= selectedLodge._id %>',); openUniqueWAModal('<%= selectedLodge._id %>', '<%= selectedLodge.phone %>');">
            Contact via WhatsApp
          </button>

      </div>
    </div>
  </div>
</div>
<% } %>
</body>
</html>